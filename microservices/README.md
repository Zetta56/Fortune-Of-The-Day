# Fortune of the Day (Monolithic)
This version of Fortune of the Day runs on microservice architecture, comprised of an Elastic Beanstalk environment and a DynamoDB table.


## Setup
1. Install [EB CLI](https://github.com/aws/aws-elastic-beanstalk-cli-setup)
2. Open the variables.ps1 file
   - Set $profile to the name of your IAM profile on your local computer
   - Set $assetBucket to the desired name of your asset bucket
3. Run `cd microservices/server`
4. Create a .env file containing the line `ASSET_BUCKET=<asset_bucket_name>`
   - Replace `<asset_bucket_name>` with the desired name of your asset bucket

## Deployment
1. Run `cd microservices/scripts`
2. Create and seed a DynamoDB table with `./seed_ddb.ps1`
3. Upload your assets to S3 with `./upload_assets.ps1`
4. Deploy your Elastic Beanstalk environment with `. ./launch_beanstalk.ps1`

### Configuring a Domain
1. Register a domain name (ex. [AWS Route 53](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/domain-register.html), [Google Domain](https://domains.google/))
2. Navigate to https://console.aws.amazon.com/route53
3. Click Hosted Zones > Create Hosted Zone, and then create a public hosted zone with the same domain name as in step 1
4. Add your Route 53 nameservers (found in your hosted zone NS records) to your domain

### Enabling HTTPS
5. Navigate to https://console.aws.amazon.com/acm/home
6. Click **Request Certificate**, and then request a public certificate with the following attributes:
   - Fully Qualified Domain Name: \<Your Domain Name\>, *.\<Your Domain Name\>
   - Validation Method: DNS
   - Key Algorithm: RSA 2048
7. Click on your certificate, and then click **Create Record in Route 53**
8. Navigate to https://console.aws.amazon.com/cloudfront
9. Click **Create Distribution**, and create a distribution with the following settings:
   - Origin Domain: \<Your S3 Bucket\>
   - Origin Access: \<Origin Access Control Settings\>
   - Viewer Protocol Policy: Redirect HTTP to HTTPS
   - Web Application Firewall (WAF): \<Your Preference\>
   - Price Class: \<Your Preference\>
   - Alternate Domain Name: static.\<Your Domain Name\>
   - Custom SSL Certificate: \<Your SSL Certificate From Step 6\>
10. Set your S3 bucket policy to the Origin Access Control policy generated by Cloudfront

### Configuring DNS Records
11. Navigate to https://console.aws.amazon.com/route53
12. Click on your hosted zone > Create Record
13. Create a record with the following attributes
    - Record Name: static
    - Record Type: A
    - Alias: True
    - Route Traffic To: Cloudfront Distribution, \<Your Cloudfront Distribution\>
    - Routing Policy: Simple Routing
14. Create a record with the following attributes
    - Record Name: www
    - Record Type: A
    - Alias: True
    - Route Traffic To: Elastic Beanstalk Environment, us-east-2, \<Your Beanstalk Environment\>
    - Routing Policy: Simple Routing

To terminate your application, run `. ./terminate.ps1`