# Fortune of the Day (Monolithic)
This version of Fortune of the Day runs on microservice architecture, comprised of an Elastic Beanstalk environment and a DynamoDB table.


## Setup
1. Create a Lambda role with full access to DynamoDB
2. Open the variables.ps1 file
   - Set $lambdaRoleArn to the ARN of your Lambda role
3. Modify the first line in client/index.js to `const backendURL = <your_backend_url>`
   - Replace <your_backend_url> with the URL you plan to route to your server (ex. https://www.example.com)

### Configuring a Domain
1. Register a domain name (ex. [AWS Route 53](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/domain-register.html), [Google Domain](https://domains.google/))
2. Navigate to https://console.aws.amazon.com/route53
3. Click Hosted Zones > Create Hosted Zone, and then create a public hosted zone with the same domain name as in step 1
4. Add your Route 53 nameservers (found in your hosted zone NS records) to your domain


## Deployment
1. Run `cd microservices/scripts`
2. Create and seed a DynamoDB table with `./seed_ddb.ps1`
3. Upload your assets to S3 with `./upload_assets.ps1`
4. Deploy your Elastic Beanstalk environment with `. ./upload_lambda.ps1`

### Enabling HTTPS
1. Navigate to https://console.aws.amazon.com/acm/home
2. Click **Request Certificate**, and then request a public certificate with the following attributes:
   - Fully Qualified Domain Name: \<Your Domain Name\>, *.\<Your Domain Name\>
   - Validation Method: DNS
   - Key Algorithm: RSA 2048
3. Click on your certificate, and then click **Create Record in Route 53**
4. Navigate to https://console.aws.amazon.com/cloudfront
5. Click **Create Distribution**, and create a distribution with the following settings:
   - Origin Domain: \<Your S3 Bucket\>
   - Origin Access: \<Origin Access Control Settings\>
   - Viewer Protocol Policy: Redirect HTTP to HTTPS
   - Web Application Firewall (WAF): \<Your Preference\>
   - Price Class: \<Your Preference\>
   - Alternate Domain Name: www.\<Your Domain Name\>
   - Custom SSL Certificate: \<Your SSL Certificate From Step 2\>
   - Default Root Object: index.html
6. Set your S3 bucket policy to the Origin Access Control policy generated by Cloudfront
7. Repeat steps 1 to 3 on the us-east-2 region
8. Navigate to https://console.aws.amazon.com/apigateway
9. Click **Custom Domain Names** on the left sidebar
10. Click **Create**, and create a domain name with the following attributes:
    - Domain Name: \<Your Domain Name\>
    - ACM Certificate: \<Your SSL Certificate From Step 7\>
11. Click **API Mappings**, and configure the following mapping:
    - API: \<Your API\>
    - Stage: prod
12. Set $certificateArn in varibles.ps1 to the ARN of your SSL certificate from Step 7

### Configuring DNS Records
1. Navigate to https://console.aws.amazon.com/route53
2. Click on your hosted zone > Create Record
3. Create a record with the following attributes
    - Record Name: www
    - Record Type: A
    - Alias: True
    - Route Traffic To: Cloudfront Distribution, \<Your Cloudfront Distribution\>
    - Routing Policy: Simple Routing
4. Create a record with the following attributes
    - Record Name: api
    - Record Type: A
    - Alias: True
    - Route Traffic To: API Gateway API, us-east-2, \<Your API Gateway\>
    - Routing Policy: Simple Routing

To terminate your application, run `./terminate.ps1`